<!-- build time:Sat Nov 21 2020 18:40:49 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>Flink Table API window操作 | 布兰特 | 不忘初心</title><meta name="description" content="Table API是用于流和批处理的统一的关系API。Table API查询可以直接在批处理或流输入上运行而无需修改。Table API是SQL语言的超集，是专门为与Apache Flink配合使用而设计的。Table API是用于Scala和Java的语言集成的API。Table API查询不是将查询指定为SQL，而是以Java或Scala中的语言嵌入样式定义，并具有IDE支持，例如自动完成和语"><meta property="og:type" content="article"><meta property="og:title" content="Flink Table API  window操作"><meta property="og:url" content="cpeixin.cn/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/index.html"><meta property="og:site_name" content="布兰特 | 不忘初心"><meta property="og:description" content="Table API是用于流和批处理的统一的关系API。Table API查询可以直接在批处理或流输入上运行而无需修改。Table API是SQL语言的超集，是专门为与Apache Flink配合使用而设计的。Table API是用于Scala和Java的语言集成的API。Table API查询不是将查询指定为SQL，而是以Java或Scala中的语言嵌入样式定义，并具有IDE支持，例如自动完成和语"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677557-ac56b3f3-5d62-49c2-bc8d-371311a38588.png#align=left&display=inline&height=576&margin=%5Bobject%20Object%5D&originHeight=576&originWidth=1034&size=0&status=done&style=none&width=1034"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677531-26cbfcc9-53d2-4794-a22a-ab191c32b617.png#align=left&display=inline&height=578&margin=%5Bobject%20Object%5D&originHeight=578&originWidth=1052&size=0&status=done&style=none&width=1052"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677644-29984377-bb5e-4a2e-82e5-c4256637fc0e.png#align=left&display=inline&height=584&margin=%5Bobject%20Object%5D&originHeight=584&originWidth=1070&size=0&status=done&style=none&width=1070"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677553-ea722757-2429-4f9e-964c-4cd623e0639f.png#align=left&display=inline&height=827&margin=%5Bobject%20Object%5D&originHeight=827&originWidth=1457&size=0&status=done&style=none&width=1457"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677557-526dcd68-ed8b-46bb-bbbc-6e1202a00148.png#align=left&display=inline&height=452&margin=%5Bobject%20Object%5D&originHeight=452&originWidth=1419&size=0&status=done&style=none&width=1419"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677655-4393133b-b577-49e7-bf1a-df3e99644ad3.png#align=left&display=inline&height=499&margin=%5Bobject%20Object%5D&originHeight=499&originWidth=1419&size=0&status=done&style=none&width=1419"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677561-8847663c-2ad7-4851-819f-7282af1c3f79.png#align=left&display=inline&height=388&margin=%5Bobject%20Object%5D&originHeight=388&originWidth=1419&size=0&status=done&style=none&width=1419"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677562-436149c7-1258-45b5-9a12-52099ebac5a9.png#align=left&display=inline&height=488&margin=%5Bobject%20Object%5D&originHeight=488&originWidth=1419&size=0&status=done&style=none&width=1419"><meta property="article:published_time" content="2019-06-15T09:13:04.000Z"><meta property="article:modified_time" content="2020-09-06T01:31:09.801Z"><meta property="article:author" content="Brent"><meta property="article:tag" content="Flink"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677557-ac56b3f3-5d62-49c2-bc8d-371311a38588.png#align=left&display=inline&height=576&margin=%5Bobject%20Object%5D&originHeight=576&originWidth=1034&size=0&status=done&style=none&width=1034"><link rel="canonical" href="cpeixin.cn/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/index.html"><link rel="alternate" href="/atom.xml" title="布兰特 | 不忘初心" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 4.2.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/cpeixin" target="_blank" rel="external nofollow noopener noreferrer"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Brent</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">大数据工程师 &amp; 机器学习</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Malaysia</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/cpeixin" target="_blank" title="Github" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/1970875963" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>人处在一种默默奋斗的状态，精神就会从琐碎生活中得到升华</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DataBase/">DataBase</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataBases/">DataBases</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="category-list-count">109</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">31</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apriori/" rel="tag">Apriori</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/" rel="tag">CPU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DMP/" rel="tag">DMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decision-Tree/" rel="tag">Decision Tree</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EM/" rel="tag">EM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ETL/" rel="tag">ETL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/" rel="tag">Flink</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPT-2/" rel="tag">GPT-2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/" rel="tag">HBase</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HashMap/" rel="tag">HashMap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/" rel="tag">IDEA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K-Means/" rel="tag">K-Means</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KNN/" rel="tag">KNN</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/" rel="tag">LRU淘汰算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Naive-Bayes/" rel="tag">Naive Bayes</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OLAP/" rel="tag">OLAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PageRank/" rel="tag">PageRank</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Parquet/" rel="tag">Parquet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Random-Forest/" rel="tag">Random Forest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVM/" rel="tag">SVM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdfs/" rel="tag">hdfs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kali/" rel="tag">kali</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/" rel="tag">mapreduce</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paxos/" rel="tag">paxos</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/" rel="tag">scala</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsock/" rel="tag">shadowsock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skipList/" rel="tag">skipList</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sklearn/" rel="tag">sklearn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/" rel="tag">yarn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" rel="tag">二分查找</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="tag">二叉树</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" rel="tag">动态规划</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%9E%E6%BA%AF/" rel="tag">回溯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A0%86/" rel="tag">堆</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" rel="tag">布隆过滤器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" rel="tag">散列表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" rel="tag">数据仓库</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" rel="tag">数据清洗</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" rel="tag">数据采集</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/" rel="tag">时间序列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/" rel="tag">服务器安全</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%88/" rel="tag">栈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/" rel="tag">特征工程</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/" rel="tag">用户画像</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" rel="tag">红黑树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" rel="tag">线性表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8D%E5%90%91%E9%87%8F/" rel="tag">词向量</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" rel="tag">逻辑回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">链表</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%9F%E5%88%97/" rel="tag">队列</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/Apriori/" style="font-size:13.11px">Apriori</a> <a href="/tags/CPU/" style="font-size:13px">CPU</a> <a href="/tags/DMP/" style="font-size:13px">DMP</a> <a href="/tags/Decision-Tree/" style="font-size:13.44px">Decision Tree</a> <a href="/tags/EM/" style="font-size:13.11px">EM</a> <a href="/tags/ETL/" style="font-size:13px">ETL</a> <a href="/tags/Flink/" style="font-size:14px">Flink</a> <a href="/tags/GPT-2/" style="font-size:13px">GPT-2</a> <a href="/tags/HBase/" style="font-size:13.56px">HBase</a> <a href="/tags/HashMap/" style="font-size:13px">HashMap</a> <a href="/tags/IDEA/" style="font-size:13px">IDEA</a> <a href="/tags/K-Means/" style="font-size:13px">K-Means</a> <a href="/tags/KNN/" style="font-size:13.11px">KNN</a> <a href="/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/" style="font-size:13px">LRU淘汰算法</a> <a href="/tags/Naive-Bayes/" style="font-size:13.11px">Naive Bayes</a> <a href="/tags/OLAP/" style="font-size:13px">OLAP</a> <a href="/tags/PageRank/" style="font-size:13.11px">PageRank</a> <a href="/tags/Parquet/" style="font-size:13px">Parquet</a> <a href="/tags/Random-Forest/" style="font-size:13px">Random Forest</a> <a href="/tags/SVM/" style="font-size:13.11px">SVM</a> <a href="/tags/docker/" style="font-size:13.11px">docker</a> <a href="/tags/flask/" style="font-size:13.11px">flask</a> <a href="/tags/flink/" style="font-size:13px">flink</a> <a href="/tags/hdfs/" style="font-size:13.33px">hdfs</a> <a href="/tags/hive/" style="font-size:13.44px">hive</a> <a href="/tags/java/" style="font-size:13px">java</a> <a href="/tags/kafka/" style="font-size:13.67px">kafka</a> <a href="/tags/kali/" style="font-size:13px">kali</a> <a href="/tags/mapreduce/" style="font-size:13px">mapreduce</a> <a href="/tags/mysql/" style="font-size:13.22px">mysql</a> <a href="/tags/paxos/" style="font-size:13.11px">paxos</a> <a href="/tags/python/" style="font-size:13.56px">python</a> <a href="/tags/redis/" style="font-size:13.33px">redis</a> <a href="/tags/scala/" style="font-size:13.33px">scala</a> <a href="/tags/shadowsock/" style="font-size:13px">shadowsock</a> <a href="/tags/skipList/" style="font-size:13px">skipList</a> <a href="/tags/sklearn/" style="font-size:13px">sklearn</a> <a href="/tags/spark/" style="font-size:13.89px">spark</a> <a href="/tags/yarn/" style="font-size:13px">yarn</a> <a href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" style="font-size:13.11px">二分查找</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size:13.22px">二叉树</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size:13px">动态规划</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size:13px">单例模式</a> <a href="/tags/%E5%9B%9E%E6%BA%AF/" style="font-size:13px">回溯</a> <a href="/tags/%E5%A0%86/" style="font-size:13px">堆</a> <a href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" style="font-size:13px">布隆过滤器</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size:13.78px">排序</a> <a href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" style="font-size:13px">散列表</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size:13.78px">数据仓库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" style="font-size:13px">数据清洗</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" style="font-size:13px">数据采集</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size:13px">数组</a> <a href="/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/" style="font-size:13px">时间序列</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/" style="font-size:13.11px">服务器安全</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">栈</a> <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size:13px">深度学习</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size:13px">爬虫</a> <a href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/" style="font-size:13.33px">特征工程</a> <a href="/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/" style="font-size:13.11px">用户画像</a> <a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" style="font-size:13px">红黑树</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" style="font-size:13px">线性表</a> <a href="/tags/%E8%AF%8D%E5%90%91%E9%87%8F/" style="font-size:13px">词向量</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size:13px">递归</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" style="font-size:13px">逻辑回归</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size:13.11px">链表</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size:13px">队列</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></p><p class="item-title"><a href="/2020/11/21/Flink%E6%B6%88%E8%B4%B9Kafka%E4%BB%A5%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE/" class="title">Flink消费Kafka以及参数设置</a></p><p class="item-date"><time datetime="2020-11-21T10:25:43.000Z" itemprop="datePublished">2020-11-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></p><p class="item-title"><a href="/2020/11/19/%E5%85%B3%E4%BA%8EHive%E4%B8%AD%E7%9A%84NULL/" class="title">关于Hive中的NULL</a></p><p class="item-date"><time datetime="2020-11-18T16:35:14.000Z" itemprop="datePublished">2020-11-19</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></p><p class="item-title"><a href="/2020/10/28/DMP%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%80%89%E5%9E%8B%E8%80%83%E9%87%8F/" class="title">DMP系统设计的选型考量</a></p><p class="item-date"><time datetime="2020-10-27T16:14:18.000Z" itemprop="datePublished">2020-10-28</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></p><p class="item-title"><a href="/2020/10/03/HBase%E4%B8%ADbloomfilter%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0/" class="title">HBase中bloomfilter源码实现</a></p><p class="item-date"><time datetime="2020-10-03T08:10:56.000Z" itemprop="datePublished">2020-10-03</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></p><p class="item-title"><a href="/2020/09/30/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9C%A8HBase%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" class="title">布隆过滤器在HBase中的应用</a></p><p class="item-date"><time datetime="2020-09-30T07:18:58.000Z" itemprop="datePublished">2020-09-30</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-Flink-Table-API-window操作" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">Flink Table API window操作</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/" class="article-date"><time datetime="2019-06-15T09:13:04.000Z" itemprop="datePublished">2019-06-15</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/Flink/" rel="tag">Flink</a></span> <span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/" class="leancloud_visitors" data-flag-title="Flink Table API  window操作">0</span></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 5.9k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 26(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>Table API是用于流和批处理的统一的关系API。Table API查询可以直接在批处理或流输入上运行而无需修改。Table API是SQL语言的超集，是专门为与Apache Flink配合使用而设计的。Table API是用于Scala和Java的语言集成的API。Table API查询不是将查询指定为SQL，而是以Java或Scala中的语言嵌入样式定义，并具有IDE支持，例如自动完成和语法验证。<br><br><br>Table API与Flink的SQL集成共享其API的许多概念和部分。看一下<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/common.html" target="_blank" rel="external nofollow noopener noreferrer">Common Concepts＆API</a>，了解如何注册表或创建Table对象。“ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/streaming" target="_blank" rel="external nofollow noopener noreferrer">流概念”</a>页面讨论了流的特定概念，例如动态表和时间属性。<br><br><br>下面我们将进行Table API在流式处理中的操作，在实际的工作中，Flink也是大多数场景都是在流计算中使用。<br></p><p><a name="group-windows"></a></p><h3 id="Group-Windows"><a href="#Group-Windows" class="headerlink" title="Group Windows"></a>Group Windows</h3><p>“Group”窗口根据时间或行计数间隔将组行聚合为有限的组，并每组评估一次聚合函数。对于批处理表，窗口是按时间间隔对记录进行分组的便捷快捷方式。<br><br><br>Windows是使用该window(w: GroupWindow)子句定义的，并且需要使用该as子句指定的别名。为了按窗口对表进行分组，必须在groupBy(…)子句中像常规分组属性一样引用窗口别名。以下示例显示如何在表上定义窗口聚合。<br></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> table = input</span><br><span class="line">  .window([w: <span class="type">GroupWindow</span>] as <span class="symbol">'w</span>)  <span class="comment">// define window with alias w</span></span><br><span class="line">  .groupBy(<span class="symbol">'w</span>)   <span class="comment">// group the table by window w</span></span><br><span class="line">  .select(<span class="symbol">'b</span>.sum)  <span class="comment">// aggregate</span></span><br></pre></td></tr></table></figure><p><br>在流环境中，如果窗口聚合除对窗口以外的一个或多个属性进行分组，则只能并行计算窗口聚合，即，groupBy(…)子句引用了窗口别名和至少一个其他属性。groupBy(…)子句仅引用一个窗口别名（如在上面的例子）只能由一个单一的，非平行的任务进行评估。以下示例显示如何使用其他分组属性定义窗口聚合。<br></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> table = input</span><br><span class="line">  .window([w: <span class="type">GroupWindow</span>] as <span class="symbol">'w</span>) <span class="comment">// define window with alias w</span></span><br><span class="line">  .groupBy(<span class="symbol">'w</span>, <span class="symbol">'a</span>)  <span class="comment">// group the table by attribute a and window w </span></span><br><span class="line">  .select(<span class="symbol">'a</span>, <span class="symbol">'b</span>.sum)  <span class="comment">// aggregate</span></span><br></pre></td></tr></table></figure><p><br>窗口属性诸如开始，结束，或一个时间窗口的rowtime时间戳可以在选择语句被添加为窗口别名作为的一个属性w.start，w.end以及w.rowtime分别。窗口开始和行时间时间戳是包含窗口的上下边界。相反，窗口结束时间戳是唯一的窗口上边界。例如，从下午2点开始的30分钟滚动窗口将具有14:00:00.000开始时间戳记，14:29:59.999行时间时间戳记和14:30:00.000结束时间戳记。<br></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> table = input</span><br><span class="line">  .window([w: <span class="type">GroupWindow</span>] as <span class="symbol">'w</span>)  <span class="comment">// define window with alias w</span></span><br><span class="line">  .groupBy(<span class="symbol">'w</span>, <span class="symbol">'a</span>)  <span class="comment">// group the table by attribute a and window w </span></span><br><span class="line">  .select(<span class="symbol">'a</span>, <span class="symbol">'w</span>.start, <span class="symbol">'w</span>.end, <span class="symbol">'w</span>.rowtime, <span class="symbol">'b</span>.count) <span class="comment">// aggregate and add window start, end, and rowtime timestamps</span></span><br></pre></td></tr></table></figure><p><br>该Window参数定义行如何映射到窗口。Window不是用户可以实现的接口。相反，Table API提供了一组Window具有特定语义的预定义类，这些预定义类被转换为基础DataStream或DataSet操作。支持的窗口定义在下面列出。<br></p><p><a name="tumble-tumbling-windows"></a></p><h4 id="Tumbling-Windows"><a href="#Tumbling-Windows" class="headerlink" title="Tumbling Windows"></a>Tumbling Windows</h4><p>滚动窗口将行分配给固定长度的非重叠连续窗口。例如，5分钟的滚动窗口以5分钟为间隔对行进行分组。可以在事件时间，处理时间或行数上定义滚动窗口。<br><br><br>滚动窗口是使用以下<code>Tumble</code>类定义的：</p><table><thead><tr><th>方法</th><th align="left">描述</th></tr></thead><tbody><tr><td>over</td><td align="left">将窗口的长度定义为时间或行计数间隔。</td></tr><tr><td>on</td><td align="left">用于分组（时间间隔）或排序（行计数）的时间属性。对于批查询，它可以是任何Long或Timestamp属性。对于流查询，它必须是<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/streaming/time_attributes.html" target="_blank" rel="external nofollow noopener noreferrer">声明的event-time或processing-time time属性</a>。</td></tr><tr><td>as</td><td align="left">为窗口分配别名。别名用于在以下<code>groupBy()</code>子句中引用窗口，并可以选择在子句中选择窗口属性，例如窗口开始，结束或行时间时间戳<code>select()</code>。</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Tumbling Event-time Window</span><br><span class="line">.window(Tumble over 10.minutes on &#39;rowtime as &#39;w)</span><br><span class="line">&#x2F;&#x2F; Tumbling Processing-time Window (assuming a processing-time attribute &quot;proctime&quot;)</span><br><span class="line">.window(Tumble over 10.minutes on &#39;proctime as &#39;w)</span><br><span class="line">&#x2F;&#x2F; Tumbling Row-count Window (assuming a processing-time attribute &quot;proctime&quot;)</span><br><span class="line">.window(Tumble over 10.rows on &#39;proctime as &#39;w)</span><br></pre></td></tr></table></figure><p><a name="slide-sliding-windows"></a></p><h4><a href="#" class="headerlink"></a></h4><p><a name="HgSGU"></a></p><h4 id="Sliding-Windows"><a href="#Sliding-Windows" class="headerlink" title="Sliding Windows"></a>Sliding Windows</h4><p><br>滑动窗口的大小固定，并以指定的滑动间隔滑动。如果滑动间隔小于窗口大小，则滑动窗口重叠。因此，可以将行分配给多个窗口。例如，一个15分钟大小的滑动窗口和5分钟的滑动间隔将每行分配给3个15分钟大小的不同窗口，这些窗口以5分钟的间隔进行评估。可以在事件时间，处理时间或行数上定义滑动窗口。<br><br><br>滑动窗口是通过使用以下<code>Slide</code>类来定义的：</p><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">over</td><td align="left">将窗口的长度定义为时间或行计数间隔。</td></tr><tr><td align="left">every</td><td align="left">将幻灯片间隔定义为时间间隔或行计数间隔。滑动间隔必须与尺寸间隔具有相同的类型。</td></tr><tr><td align="left">on</td><td align="left">用于分组（时间间隔）或排序（行计数）的时间属性。对于批查询，它可以是任何Long或Timestamp属性。对于流查询，它必须是<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/streaming/time_attributes.html" target="_blank" rel="external nofollow noopener noreferrer">声明的event-time或processing-time time属性</a>。</td></tr><tr><td align="left">as</td><td align="left">为窗口分配别名。别名用于在以下<code>groupBy()</code>子句中引用窗口，并可以选择在子句中选择窗口属性，例如窗口开始，结束或行时间时间戳<code>select()</code>。</td></tr></tbody></table><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sliding Event-time Window</span></span><br><span class="line">.window(<span class="type">Slide</span> over <span class="number">10.</span>minutes every <span class="number">5.</span>minutes on <span class="symbol">'rowtime</span> as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Sliding Processing-time window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Slide</span> over <span class="number">10.</span>minutes every <span class="number">5.</span>minutes on <span class="symbol">'proctime</span> as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Sliding Row-count window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Slide</span> over <span class="number">10.</span>rows every <span class="number">5.</span>rows on <span class="symbol">'proctime</span> as <span class="symbol">'w</span>)</span><br></pre></td></tr></table></figure><p><a name="session-session-windows"></a></p><h4 id="-1"><a href="#-1" class="headerlink"></a></h4><p><a name="KayXD"></a></p><h4 id="Session-Windows"><a href="#Session-Windows" class="headerlink" title="Session Windows"></a>Session Windows</h4><p><br>会话窗口没有固定的大小，但是其边界由不活动的时间间隔定义，即，如果在定义的间隔时间段内未出现任何事件，则会话窗口关闭。例如，间隔30分钟的会话窗口在30分钟不活动后观察到一行时开始（否则该行将被添加到现有窗口），如果在30分钟内未添加任何行，则关闭该窗口。会话窗口可以在事件时间或处理时间工作。<br><br><br>通过使用以下<code>Session</code>类定义会话窗口：</p><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">withGap</td><td align="left">将两个窗口之间的间隔定义为时间间隔。</td></tr><tr><td align="left">on</td><td align="left">用于分组（时间间隔）或排序（行计数）的时间属性。对于批查询，它可以是任何Long或Timestamp属性。对于流查询，它必须是<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/streaming/time_attributes.html" target="_blank" rel="external nofollow noopener noreferrer">声明的event-time或processing-time time属性</a>。</td></tr><tr><td align="left">as</td><td align="left">为窗口分配别名。别名用于在以下<code>groupBy()</code>子句中引用窗口，并可以选择在子句中选择窗口属性，例如窗口开始，结束或行时间时间戳<code>select()</code>。</td></tr></tbody></table><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Session Event-time Window</span></span><br><span class="line">.window(<span class="type">Session</span> withGap <span class="number">10.</span>minutes on <span class="symbol">'rowtime</span> as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Session Processing-time Window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Session</span> withGap <span class="number">10.</span>minutes on <span class="symbol">'proctime</span> as <span class="symbol">'w</span>)</span><br></pre></td></tr></table></figure><p><a name="over-windows"></a></p><h3 id="Over-Windows"><a href="#Over-Windows" class="headerlink" title="Over Windows"></a>Over Windows</h3><p><br>窗口聚合是标准SQL（OVER子句）中已知的，并在SELECT查询的子句中定义。与在GROUP BY子句中指定的组窗口不同，在窗口上方不会折叠行。取而代之的是，在窗口聚合中，为每个输入行在其相邻行的范围内计算一个聚合。<br>窗口是使用window(w: OverWindow<em>)子句（over_window(</em>OverWindow)在Python API中使用）定义的，并通过select()方法中的别名进行引用。以下示例显示如何在表上定义窗口聚合<br></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> table = input</span><br><span class="line">  .window([w: <span class="type">OverWindow</span>] as <span class="symbol">'w</span>)              <span class="comment">// define over window with alias w</span></span><br><span class="line">  .select(<span class="symbol">'a</span>, <span class="symbol">'b</span>.sum over <span class="symbol">'w</span>, <span class="symbol">'c</span>.min over <span class="symbol">'w</span>) <span class="comment">// aggregate over the over window w</span></span><br></pre></td></tr></table></figure><p><br>OverWindow在限定范围内的数据对其进行聚合计算。OverWindow不是用户可以实现的接口。相反，Table API提供了Over用于配置上方窗口属性的类。可以在事件时间或处理时间以及指定为时间间隔或行计数的范围上定义窗口上方。受支持的over窗口定义作为Over（和其他类）上的方法公开，并在下面列出：<br></p><table><thead><tr><th>方法</th><th align="left">需要</th><th align="left">描述</th></tr></thead><tbody><tr><td>partitionBy</td><td align="left">可选的</td><td align="left">在一个或多个属性上定义输入的分区。每个分区都经过单独排序，并且聚合函数分别应用于每个分区。<br><strong>注意：</strong>在流环境中，仅当窗口包含partition by子句时，才可以并行计算整个窗口聚合。如果没有<code>partitionBy(...)</code>流，则由单个非并行任务处理。</td></tr><tr><td>orderBy</td><td align="left">需要</td><td align="left">定义每个分区内的行顺序，从而定义将聚合函数应用于行的顺序。<br><strong>注意：</strong>对于流查询，它必须是<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/streaming/time_attributes.html" target="_blank" rel="external nofollow noopener noreferrer">声明的event-time或processing-time time属性</a>。当前，仅支持单个sort属性。</td></tr><tr><td>preceding</td><td align="left">可选的</td><td align="left">定义窗口中包含的并在当前行之前的行的间隔。该间隔可以指定为时间间隔或行计数间隔。<br>用时间间隔的大小（例如，<code>10.minutes</code>时间间隔或<code>10.rows</code>行计数间隔）指定<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/tableApi.html#bounded-over-windows" target="_blank" rel="external nofollow noopener noreferrer">窗口边界</a>。<br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/tableApi.html#unbounded-over-windows" target="_blank" rel="external nofollow noopener noreferrer">窗口</a>上的<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/tableApi.html#unbounded-over-windows" target="_blank" rel="external nofollow noopener noreferrer">无边界</a>是使用常量指定的，即<code>UNBOUNDED_RANGE</code>用于时间间隔或<code>UNBOUNDED_ROW</code>用于行计数间隔。Windows上的无边界从分区的第一行开始。<br>如果<code>preceding</code>条款被省略，<code>UNBOUNDED_RANGE</code>并且<code>CURRENT_RANGE</code>被用作默认<code>preceding</code>和<code>following</code>用于该窗口。</td></tr><tr><td>following</td><td align="left">可选的</td><td align="left">定义窗口中包含并紧随当前行的行的窗口间隔。该间隔必须与前面的间隔（时间或行计数）以相同的单位指定。<br>目前，不支持具有当前行之后的行的窗口。相反，您可以指定两个常量之一：<br>- <code>CURRENT_ROW</code> 将窗口的上限设置为当前行。<br>- <code>CURRENT_RANGE</code> 将窗口的上限设置为当前行的排序键，即，与当前行具有相同排序键的所有行都包含在窗口中。<br></td></tr><tr><td>如果<code>following</code>省略该子句，则时间间隔窗口<code>CURRENT_RANGE</code>的上限定义为，行计数间隔窗口的上限定义为<code>CURRENT_ROW</code>。</td><td align="left"></td><td align="left"></td></tr><tr><td>as</td><td align="left">需要</td><td align="left">为上方窗口分配别名。别名用于引用以下<code>select()</code>子句中的over窗口。</td></tr></tbody></table><p><strong><br></strong>注意：**当前，<code>select()</code>必须在相同的窗口内计算同一调用中的所有聚合函数。<br></p><p><a name="unbounded-over-windows"></a></p><h4 id="Unbounded-Over-Windows"><a href="#Unbounded-Over-Windows" class="headerlink" title="Unbounded Over Windows"></a>Unbounded Over Windows</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unbounded Event-time over window (assuming an event-time attribute "rowtime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'rowtime</span> preceding <span class="type">UNBOUNDED_RANGE</span> as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Unbounded Processing-time over window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'proctime</span> preceding <span class="type">UNBOUNDED_RANGE</span> as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Unbounded Event-time Row-count over window (assuming an event-time attribute "rowtime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'rowtime</span> preceding <span class="type">UNBOUNDED_ROW</span> as <span class="symbol">'w</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Unbounded Processing-time Row-count over window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'proctime</span> preceding <span class="type">UNBOUNDED_ROW</span> as <span class="symbol">'w</span>)</span><br></pre></td></tr></table></figure><p><a name="bounded-over-windows"></a></p><h4 id="-2"><a href="#-2" class="headerlink"></a></h4><p><a name="AcOqj"></a></p><h4 id="bounded-Over-Windows"><a href="#bounded-Over-Windows" class="headerlink" title="bounded Over Windows"></a>bounded Over Windows</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bounded Event-time over window (assuming an event-time attribute "rowtime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'rowtime</span> preceding <span class="number">1.</span>minutes as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Bounded Processing-time over window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'proctime</span> preceding <span class="number">1.</span>minutes as <span class="symbol">'w</span>)</span><br><span class="line"><span class="comment">// Bounded Event-time Row-count over window (assuming an event-time attribute "rowtime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'rowtime</span> preceding <span class="number">10.</span>rows as <span class="symbol">'w</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Bounded Processing-time Row-count over window (assuming a processing-time attribute "proctime")</span></span><br><span class="line">.window(<span class="type">Over</span> partitionBy <span class="symbol">'a</span> orderBy <span class="symbol">'proctime</span> preceding <span class="number">10.</span>rows as <span class="symbol">'w</span>)</span><br></pre></td></tr></table></figure><p><a name="row-based-operations"></a></p><h3 id="基于行的操作"><a href="#基于行的操作" class="headerlink" title="基于行的操作"></a>基于行的操作</h3><p>基于行的操作生成具有多列的输出。<br></p><table><thead><tr><th align="left">算子</th><th align="center">描述</th></tr></thead><tbody><tr><td align="left"><strong>Map</strong><br>Batch\Streaming</td><td align="center">使用用户定义的标量函数或内置标量函数执行映射操作。如果输出类型是复合类型，则输出将被展平。```</td></tr><tr><td align="left">class MyMapFunction extends ScalarFunction {</td><td align="center"></td></tr><tr><td align="left">def eval(a: String): Row = {</td><td align="center"></td></tr><tr><td align="left">Row.of(a, “pre-“ + a)</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">override def getResultType(signature: Array[Class[_]]): TypeInformation[_] =</td><td align="center"></td></tr><tr><td align="left">Types.ROW(Types.STRING, Types.STRING)</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">val func = new MyMapFunction()</td><td align="center"></td></tr><tr><td align="left">val table = input</td><td align="center"></td></tr><tr><td align="left">.map(func(‘c)).as(‘a, ‘b)</td><td align="center"></td></tr><tr><td align="left"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> |</span><br><span class="line">| **FlatMap**&lt;br &#x2F;&gt;Batch\Streaming | 使用表函数执行flatMap操作。</span><br></pre></td></tr></table></figure></td><td align="center"></td></tr><tr><td align="left">class MyFlatMapFunction extends TableFunction[Row] {</td><td align="center"></td></tr><tr><td align="left">def eval(str: String): Unit = {</td><td align="center"></td></tr><tr><td align="left">if (str.contains(“#”)) {</td><td align="center"></td></tr><tr><td align="left">str.split(“#”).foreach({ s =&gt;</td><td align="center"></td></tr><tr><td align="left">val row = new Row(2)</td><td align="center"></td></tr><tr><td align="left">row.setField(0, s)</td><td align="center"></td></tr><tr><td align="left">row.setField(1, s.length)</td><td align="center"></td></tr><tr><td align="left">collect(row)</td><td align="center"></td></tr><tr><td align="left">})</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">override def getResultType: TypeInformation[Row] = {</td><td align="center"></td></tr><tr><td align="left">Types.ROW(Types.STRING, Types.INT)</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">val func = new MyFlatMapFunction</td><td align="center"></td></tr><tr><td align="left">val table = input</td><td align="center"></td></tr><tr><td align="left">.flatMap(func(‘c)).as(‘a, ‘b)</td><td align="center"></td></tr><tr><td align="left"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> |</span><br><span class="line">| **Aggregate**&lt;br &#x2F;&gt;Batch\Streaming&lt;br &#x2F;&gt;**Result Updating** | 使用聚合函数执行聚合操作。您必须使用select语句关闭“聚合”，并且select语句不支持聚合功能。如果输出类型是复合类型，则聚合的输出将被展平。&lt;br &#x2F;&gt;case class MyMinMaxAcc(var min: Int, var max: Int)&lt;br &#x2F;&gt;class MyMinMax extends AggregateFunction[Row, MyMinMaxAcc] &#123;&lt;br &#x2F;&gt;  def accumulate(acc: MyMinMaxAcc, value: Int): Unit &#x3D; &#123;&lt;br &#x2F;&gt;    if (value &lt; acc.min) &#123;&lt;br &#x2F;&gt;      acc.min &#x3D; value&lt;br &#x2F;&gt;    &#125;&lt;br &#x2F;&gt;    if (value &gt; acc.max) &#123;&lt;br &#x2F;&gt;      acc.max &#x3D; value&lt;br &#x2F;&gt;    &#125;&lt;br &#x2F;&gt;  &#125;&lt;br &#x2F;&gt;  override def createAccumulator(): MyMinMaxAcc &#x3D; MyMinMaxAcc(0, 0)&lt;br &#x2F;&gt;  &lt;br &#x2F;&gt;  def resetAccumulator(acc: MyMinMaxAcc): Unit &#x3D; &#123;&lt;br &#x2F;&gt;    acc.min &#x3D; 0&lt;br &#x2F;&gt;    acc.max &#x3D; 0&lt;br &#x2F;&gt;  &#125;&lt;br &#x2F;&gt;  override def getValue(acc: MyMinMaxAcc): Row &#x3D; &#123;&lt;br &#x2F;&gt;    Row.of(Integer.valueOf(acc.min), Integer.valueOf(acc.max))&lt;br &#x2F;&gt;  &#125;&lt;br &#x2F;&gt;  override def getResultType: TypeInformation[Row] &#x3D; &#123;&lt;br &#x2F;&gt;    new RowTypeInfo(Types.INT, Types.INT)&lt;br &#x2F;&gt;  &#125;&lt;br &#x2F;&gt;&#125;&lt;br &#x2F;&gt;val myAggFunc &#x3D; new MyMinMax&lt;br &#x2F;&gt;val table &#x3D; input&lt;br &#x2F;&gt;  .groupBy(&#39;key)&lt;br &#x2F;&gt;  .aggregate(myAggFunc(&#39;a) as (&#39;x, &#39;y))&lt;br &#x2F;&gt;  .select(&#39;key, &#39;x, &#39;y) |</span><br><span class="line">| **组窗口聚合**&lt;br &#x2F;&gt;Batch\Streaming | 在[组窗口](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;tableApi.html#group-windows)和可能的一个或多个分组键上对表进行分组和聚集。您必须使用select语句关闭“聚合”。并且select语句不支持“ *”或聚合函数。</span><br></pre></td></tr></table></figure></td><td align="center"></td></tr><tr><td align="left">val myAggFunc = new MyMinMax</td><td align="center"></td></tr><tr><td align="left">val table = input</td><td align="center"></td></tr><tr><td align="left">.window(Tumble over 5.minutes on ‘rowtime as ‘w) // define window</td><td align="center"></td></tr><tr><td align="left">.groupBy(‘key, ‘w) // group by key and window</td><td align="center"></td></tr><tr><td align="left">.aggregate(myAggFunc(‘a) as (‘x, ‘y))</td><td align="center"></td></tr><tr><td align="left">.select(‘key, ‘x, ‘y, ‘w.start, ‘w.end) // access window properties and aggregate results</td><td align="center"></td></tr><tr><td align="left"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> |</span><br><span class="line">| **FlatAggregate**</span><br><span class="line"></span><br><span class="line">Streaming&lt;br &#x2F;&gt;**Result Updating** | 类似于**GroupBy聚合**。使用以下运行表聚合运算符将分组键上的行分组，以逐行聚合行。与AggregateFunction的区别在于TableAggregateFunction可以为一个组返回0个或更多记录。您必须使用select语句关闭“ flatAggregate”。并且select语句不支持聚合函数。&lt;br &#x2F;&gt;除了使用&#96;emitValue&#96;输出结果，还可以使用&#96;emitUpdateWithRetract&#96;方法。与不同&#96;emitValue&#96;，&#96;emitUpdateWithRetract&#96;用于发出已更新的值。此方法以缩回模式增量输出数据，即，一旦有更新，我们必须先缩回旧记录，然后再发送新的更新记录。如果在表聚合函数中定义了这两种方法，则该&#96;emitUpdateWithRetract&#96;方法将优先于该&#96;emitValue&#96;方法使用，因为这被认为比该方法更有效，&#96;emitValue&#96;因为它可以递增地输出值。有关详细信息，请[参见表聚合函数](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;functions&#x2F;udfs.html#table-aggregation-functions)。</span><br></pre></td></tr></table></figure></td><td align="center"></td></tr><tr><td align="left">import java.lang.{Integer =&gt; JInteger}</td><td align="center"></td></tr><tr><td align="left">import org.apache.flink.table.api.Types</td><td align="center"></td></tr><tr><td align="left">import org.apache.flink.table.functions.TableAggregateFunction</td><td align="center"></td></tr><tr><td align="left">/**</td><td align="center"></td></tr><tr><td align="left">* Accumulator for top2.</td><td align="center"></td></tr><tr><td align="left">*/</td><td align="center"></td></tr><tr><td align="left">class Top2Accum {</td><td align="center"></td></tr><tr><td align="left">var first: JInteger = _</td><td align="center"></td></tr><tr><td align="left">var second: JInteger = _</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">/**</td><td align="center"></td></tr><tr><td align="left">* The top2 user-defined table aggregate function.</td><td align="center"></td></tr><tr><td align="left">*/</td><td align="center"></td></tr><tr><td align="left">class Top2 extends TableAggregateFunction[JTuple2[JInteger, JInteger], Top2Accum] {</td><td align="center"></td></tr><tr><td align="left">override def createAccumulator(): Top2Accum = {</td><td align="center"></td></tr><tr><td align="left">val acc = new Top2Accum</td><td align="center"></td></tr><tr><td align="left">acc.first = Int.MinValue</td><td align="center"></td></tr><tr><td align="left">acc.second = Int.MinValue</td><td align="center"></td></tr><tr><td align="left">acc</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">def accumulate(acc: Top2Accum, v: Int) {</td><td align="center"></td></tr><tr><td align="left">if (v &gt; acc.first) {</td><td align="center"></td></tr><tr><td align="left">acc.second = acc.first</td><td align="center"></td></tr><tr><td align="left">acc.first = v</td><td align="center"></td></tr><tr><td align="left">} else if (v &gt; acc.second) {</td><td align="center"></td></tr><tr><td align="left">acc.second = v</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">def merge(acc: Top2Accum, its: JIterable[Top2Accum]): Unit = {</td><td align="center"></td></tr><tr><td align="left">val iter = its.iterator()</td><td align="center"></td></tr><tr><td align="left">while (iter.hasNext) {</td><td align="center"></td></tr><tr><td align="left">val top2 = iter.next()</td><td align="center"></td></tr><tr><td align="left">accumulate(acc, top2.first)</td><td align="center"></td></tr><tr><td align="left">accumulate(acc, top2.second)</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">def emitValue(acc: Top2Accum, out: Collector[JTuple2[JInteger, JInteger]]): Unit = {</td><td align="center"></td></tr><tr><td align="left">// emit the value and rank</td><td align="center"></td></tr><tr><td align="left">if (acc.first != Int.MinValue) {</td><td align="center"></td></tr><tr><td align="left">out.collect(JTuple2.of(acc.first, 1))</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">if (acc.second != Int.MinValue) {</td><td align="center"></td></tr><tr><td align="left">out.collect(JTuple2.of(acc.second, 2))</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">}</td><td align="center"></td></tr><tr><td align="left">val top2 = new Top2</td><td align="center"></td></tr><tr><td align="left">val orders: Table = tableEnv.from(“Orders”)</td><td align="center"></td></tr><tr><td align="left">val result = orders</td><td align="center"></td></tr><tr><td align="left">.groupBy(‘key)</td><td align="center"></td></tr><tr><td align="left">.flatAggregate(top2(‘a) as (‘v, ‘rank))</td><td align="center"></td></tr><tr><td align="left">.select(‘key, ‘v, ‘rank)</td><td align="center"></td></tr><tr><td align="left"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**注意：**对于流式查询，根据聚合类型和不同分组关键字的数量，计算查询结果所需的状态可能会无限增长。请提供具有有效保留间隔的查询配置，以防止出现过多的状态。有关详细信息，请参见[查询配置](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;streaming&#x2F;query_configuration.html)。 |</span><br><span class="line">| **Group Window FlatAggregate**&lt;br &#x2F;&gt;**Streaming** | 在[组窗口](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;tableApi.html#group-windows)和可能的一个或多个分组键上对表进行分组和聚集。您必须使用select语句关闭“ flatAggregate”。并且select语句不支持聚合函数。</span><br></pre></td></tr></table></figure></td><td align="center"></td></tr><tr><td align="left">val top2 = new Top2</td><td align="center"></td></tr><tr><td align="left">val orders: Table = tableEnv.from(“Orders”)</td><td align="center"></td></tr><tr><td align="left">val result = orders</td><td align="center"></td></tr><tr><td align="left">.window(Tumble over 5.minutes on ‘rowtime as ‘w) // define window</td><td align="center"></td></tr><tr><td align="left">.groupBy(‘a, ‘w) // group by key and window</td><td align="center"></td></tr><tr><td align="left">.flatAggregate(top2(‘b) as (‘v, ‘rank))</td><td align="center"></td></tr><tr><td align="left">.select(‘a, w.start, ‘w.end, ‘w.rowtime, ‘v, ‘rank) // access window properties and aggregate results</td><td align="center"></td></tr><tr><td align="left"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"> |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;br &#x2F;&gt;</span><br><span class="line">&lt;br &#x2F;&gt;下面是根据上面所讲到的操作，所写的小实例，每五秒统计一次每个用户目前的游戏得分情况</span><br><span class="line">&#96;&#96;&#96;scala</span><br><span class="line">package tableAPI</span><br><span class="line"></span><br><span class="line">import org.apache.flink.streaming.api.TimeCharacteristic</span><br><span class="line">import org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor</span><br><span class="line">import org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.time.Time</span><br><span class="line">import org.apache.flink.table.api.&#123;EnvironmentSettings, Slide, Table, Tumble&#125;</span><br><span class="line">import org.apache.flink.table.api.scala.StreamTableEnvironment</span><br><span class="line">import org.apache.flink.types.Row</span><br><span class="line">import org.apache.flink.streaming.api.scala._</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">object table_stream_window &#123;</span><br><span class="line">  case class GameData(user_id: String, game_id: String, game_time: Long, game_score: Int)</span><br><span class="line">  def main(args: Array[String]): Unit &#x3D; &#123;</span><br><span class="line">    val stream_env: StreamExecutionEnvironment &#x3D; StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    stream_env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)</span><br><span class="line">    val settings: EnvironmentSettings &#x3D; EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build()</span><br><span class="line">    val table_env: StreamTableEnvironment &#x3D; StreamTableEnvironment.create(stream_env, settings)</span><br><span class="line">    stream_env.setParallelism(1)</span><br><span class="line">    val socketStream: DataStream[String] &#x3D; stream_env.socketTextStream(&quot;localhost&quot;, 8888)</span><br><span class="line"></span><br><span class="line">    val gameStream: DataStream[GameData] &#x3D; socketStream.map((line: String) &#x3D;&gt; &#123;</span><br><span class="line">      val array_data: Array[String] &#x3D; line.split(&quot;,&quot;)</span><br><span class="line">      GameData(array_data(0), array_data(1), array_data(2).toLong, array_data(3).toInt)</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[GameData](Time.seconds(3))&#123;</span><br><span class="line">      override def extractTimestamp(element: GameData): Long &#x3D; &#123;</span><br><span class="line">        element.game_time</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;分组聚合操作</span><br><span class="line">    import org.apache.flink.table.api.scala._</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;创建动态Table,并且指定event time</span><br><span class="line">    val game_table: Table &#x3D; table_env.fromDataStream(gameStream,&#39;user_id,&#39;game_id,&#39;game_time.rowtime,&#39;game_score)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;开启窗口,滑动窗口</span><br><span class="line">&#x2F;&#x2F;    game_table.window(Slide.over(&quot;10.second&quot;).every(&quot;5.second&quot;).on(&quot;game_time&quot;).as(&quot;window&quot;))</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;开启窗口,滚动窗口</span><br><span class="line">&#x2F;&#x2F;    val game_score_sum: Table &#x3D; game_table.window(Tumble.over(&quot;5.second&quot;).on(&quot;game_time&quot;).as(&quot;window&quot;))</span><br><span class="line">    val game_score_sum: Table &#x3D; game_table.window(Tumble over 5.second on &#39;game_time as &#39;window)</span><br><span class="line">      .groupBy(&#39;window, &#39;user_id) &#x2F;&#x2F;必须指定窗口字段</span><br><span class="line">      .select(&#39;user_id, &#39;game_score.sum, &#39;window.start, &#39;window.end)</span><br><span class="line"></span><br><span class="line">    table_env</span><br><span class="line">      .toRetractStream[Row](game_score_sum)</span><br><span class="line">      .filter((_: (Boolean, Row))._1&#x3D;&#x3D;true)</span><br><span class="line">      .print(&quot;user_sum_score&quot;)</span><br><span class="line"></span><br><span class="line">    table_env.execute(&quot;user_sum_score——job&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td align="center"></td></tr></tbody></table><p><a name="utnP4"></a></p><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>我们在讲解 Flink Table &amp; SQL 所支持的常用算子前，需要说明一点，Flink 自从 0.9 版本开始支持 Table &amp; SQL 功能一直处于完善开发中，且在不断进行迭代。<br>我们在官网中也可以看到这样的提示：</p><blockquote><p>Please note that the Table API and SQL are not yet feature complete and are being actively developed. Not all operations are supported by every combination of [Table API, SQL] and [stream, batch] input.</p></blockquote><p>Flink Table &amp; SQL 的开发一直在进行中，并没有支持所有场景下的计算逻辑。从我个人实践角度来讲，在使用原生的 Flink Table &amp; SQL 时，务必查询官网当前版本对 Table &amp; SQL 的支持程度，尽量选择场景明确，逻辑不是极其复杂的场景。<br><a name="cqtQI"></a></p><h4 id="常用算子"><a href="#常用算子" class="headerlink" title="常用算子"></a>常用算子</h4><p>目前 Flink SQL 支持的语法主要如下：<br>复制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">query:</span><br><span class="line">  values</span><br><span class="line">  | &#123;</span><br><span class="line">      select</span><br><span class="line">      | selectWithoutFrom</span><br><span class="line">      | query UNION [ ALL ] query</span><br><span class="line">      | query EXCEPT query</span><br><span class="line">      | query INTERSECT query</span><br><span class="line">    &#125;</span><br><span class="line">    [ ORDER BY orderItem [, orderItem ]* ]</span><br><span class="line">    [ LIMIT &#123; count | ALL &#125; ]</span><br><span class="line">    [ OFFSET start &#123; ROW | ROWS &#125; ]</span><br><span class="line">    [ FETCH &#123; FIRST | NEXT &#125; [ count ] &#123; ROW | ROWS &#125; ONLY]</span><br><span class="line">orderItem:</span><br><span class="line">  expression [ ASC | DESC ]</span><br><span class="line">select:</span><br><span class="line">  SELECT [ ALL | DISTINCT ]</span><br><span class="line">  &#123; * | projectItem [, projectItem ]* &#125;</span><br><span class="line">  FROM tableExpression</span><br><span class="line">  [ WHERE booleanExpression ]</span><br><span class="line">  [ GROUP BY &#123; groupItem [, groupItem ]* &#125; ]</span><br><span class="line">  [ HAVING booleanExpression ]</span><br><span class="line">  [ WINDOW windowName AS windowSpec [, windowName AS windowSpec ]* ]</span><br><span class="line">selectWithoutFrom:</span><br><span class="line">  SELECT [ ALL | DISTINCT ]</span><br><span class="line">  &#123; * | projectItem [, projectItem ]* &#125;</span><br><span class="line">projectItem:</span><br><span class="line">  expression [ [ AS ] columnAlias ]</span><br><span class="line">  | tableAlias . *</span><br><span class="line">tableExpression:</span><br><span class="line">  tableReference [, tableReference ]*</span><br><span class="line">  | tableExpression [ NATURAL ] [ LEFT | RIGHT | FULL ] JOIN tableExpression [ joinCondition ]</span><br><span class="line">joinCondition:</span><br><span class="line">  ON booleanExpression</span><br><span class="line">  | USING &#39;(&#39; column [, column ]* &#39;)&#39;</span><br><span class="line">tableReference:</span><br><span class="line">  tablePrimary</span><br><span class="line">  [ matchRecognize ]</span><br><span class="line">  [ [ AS ] alias [ &#39;(&#39; columnAlias [, columnAlias ]* &#39;)&#39; ] ]</span><br><span class="line">tablePrimary:</span><br><span class="line">  [ TABLE ] [ [ catalogName . ] schemaName . ] tableName</span><br><span class="line">  | LATERAL TABLE &#39;(&#39; functionName &#39;(&#39; expression [, expression ]* &#39;)&#39; &#39;)&#39;</span><br><span class="line">  | UNNEST &#39;(&#39; expression &#39;)&#39;</span><br><span class="line">values:</span><br><span class="line">  VALUES expression [, expression ]*</span><br><span class="line">groupItem:</span><br><span class="line">  expression</span><br><span class="line">  | &#39;(&#39; &#39;)&#39;</span><br><span class="line">  | &#39;(&#39; expression [, expression ]* &#39;)&#39;</span><br><span class="line">  | CUBE &#39;(&#39; expression [, expression ]* &#39;)&#39;</span><br><span class="line">  | ROLLUP &#39;(&#39; expression [, expression ]* &#39;)&#39;</span><br><span class="line">  | GROUPING SETS &#39;(&#39; groupItem [, groupItem ]* &#39;)&#39;</span><br><span class="line">windowRef:</span><br><span class="line">    windowName</span><br><span class="line">  | windowSpec</span><br><span class="line">windowSpec:</span><br><span class="line">    [ windowName ]</span><br><span class="line">    &#39;(&#39;</span><br><span class="line">    [ ORDER BY orderItem [, orderItem ]* ]</span><br><span class="line">    [ PARTITION BY expression [, expression ]* ]</span><br><span class="line">    [</span><br><span class="line">        RANGE numericOrIntervalExpression &#123;PRECEDING&#125;</span><br><span class="line">      | ROWS numericExpression &#123;PRECEDING&#125;</span><br><span class="line">    ]</span><br><span class="line">    &#39;)&#39;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>可以看到 Flink SQL 和传统的 SQL 一样，支持了包含查询、连接、聚合等场景，另外还支持了包括窗口、排序等场景。下面我就以最常用的算子来做详细的讲解。<br><strong><br></strong>SELECT/AS/WHERE**<br>SELECT、WHERE 和传统 SQL 用法一样，用于筛选和过滤数据，同时适用于 DataStream 和 DataSet。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Table;</span><br><span class="line">SELECT name，age FROM Table;</span><br></pre></td></tr></table></figure><p>当然我们也可以在 WHERE 条件中使用 =、&lt;、&gt;、&lt;&gt;、&gt;=、&lt;=，以及 AND、OR 等表达式的组合：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT name，age FROM Table where name LIKE &#39;%小明%&#39;;</span><br><span class="line">SELECT * FROM Table WHERE age &#x3D; 20;</span><br><span class="line">SELECT name, age</span><br><span class="line">FROM Table</span><br><span class="line">WHERE name IN (SELECT name FROM Table2)</span><br></pre></td></tr></table></figure><p><strong>GROUP BY / DISTINCT/HAVING</strong><br>GROUP BY 用于进行分组操作，DISTINCT 用于结果去重。<br>HAVING 和传统 SQL 一样，可以用来在聚合函数之后进行筛选。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT name FROM Table;</span><br><span class="line">SELECT name, SUM(score) as TotalScore FROM Table GROUP BY name;</span><br><span class="line">SELECT name, SUM(score) as TotalScore FROM Table GROUP BY name HAVING</span><br><span class="line">SUM(score) &gt; 300;</span><br></pre></td></tr></table></figure><p><strong>JOIN</strong><br>JOIN 可以用于把来自两个表的数据联合起来形成结果表，目前 Flink 的 Join 只支持等值连接。Flink 支持的 JOIN 类型包括：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JOIN - INNER JOIN</span><br><span class="line">LEFT JOIN - LEFT OUTER JOIN</span><br><span class="line">RIGHT JOIN - RIGHT OUTER JOIN</span><br><span class="line">FULL JOIN - FULL OUTER JOIN</span><br></pre></td></tr></table></figure><p>例如，用用户表和商品表进行关联：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM User LEFT JOIN Product ON User.name &#x3D; Product.buyer</span><br><span class="line">SELECT *</span><br><span class="line">FROM User RIGHT JOIN Product ON User.name &#x3D; Product.buyer</span><br><span class="line">SELECT *</span><br><span class="line">FROM User FULL OUTER JOIN Product ON User.name &#x3D; Product.buyer</span><br></pre></td></tr></table></figure><p>LEFT JOIN、RIGHT JOIN 、FULL JOIN 相与我们传统 SQL 中含义一样。<br><strong><br></strong>WINDOW**<br>根据窗口数据划分的不同，目前 Apache Flink 有如下 3 种：</p><ul><li><strong>滚动窗口</strong>，窗口数据有固定的大小，窗口中的数据不会叠加；<br></li><li><strong>滑动窗口</strong>，窗口数据有固定大小，并且有生成间隔；<br></li><li><strong>会话窗口</strong>，窗口数据没有固定的大小，根据用户传入的参数进行划分，窗口数据无叠加；<br></li></ul><p><strong>滚动窗口</strong><br>滚动窗口的特点是：有固定大小、窗口中的数据不会重叠，如下图所示：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677557-ac56b3f3-5d62-49c2-bc8d-371311a38588.png#align=left&display=inline&height=576&margin=%5Bobject%20Object%5D&originHeight=576&originWidth=1034&size=0&status=done&style=none&width=1034" alt><br>滚动窗口的语法：<br>复制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    [gk],</span><br><span class="line">    [TUMBLE_START(timeCol, size)], </span><br><span class="line">    [TUMBLE_END(timeCol, size)], </span><br><span class="line">    agg1(col1), </span><br><span class="line">    ... </span><br><span class="line">    aggn(colN)</span><br><span class="line">FROM Tab1</span><br><span class="line">GROUP BY [gk], TUMBLE(timeCol, size)</span><br></pre></td></tr></table></figure><p>举例说明，我们需要计算每个用户每天的订单数量：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT user, TUMBLE_START(timeLine, INTERVAL &#39;1&#39; DAY) as winStart, SUM(amount) FROM Orders GROUP BY TUMBLE(timeLine, INTERVAL &#39;1&#39; DAY), user;</span><br></pre></td></tr></table></figure><p>其中，TUMBLE_START 和 TUMBLE_END 代表窗口的开始时间和窗口的结束时间，TUMBLE (timeLine, INTERVAL ‘1’ DAY) 中的 timeLine 代表时间字段所在的列，INTERVAL ‘1’ DAY 表示时间间隔为一天。<br><strong><br></strong>滑动窗口**<br>滑动窗口有固定的大小，与滚动窗口不同的是滑动窗口可以通过 slide 参数控制滑动窗口的创建频率。需要注意的是，多个滑动窗口可能会发生数据重叠，具体语义如下：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677531-26cbfcc9-53d2-4794-a22a-ab191c32b617.png#align=left&display=inline&height=578&margin=%5Bobject%20Object%5D&originHeight=578&originWidth=1052&size=0&status=done&style=none&width=1052" alt><br>滑动窗口的语法与滚动窗口相比，只多了一个 slide 参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    [gk], </span><br><span class="line">    [HOP_START(timeCol, slide, size)] ,</span><br><span class="line">    [HOP_END(timeCol, slide, size)],</span><br><span class="line">    agg1(col1), </span><br><span class="line">    ... </span><br><span class="line">    aggN(colN) </span><br><span class="line">FROM Tab1</span><br><span class="line">GROUP BY [gk], HOP(timeCol, slide, size)</span><br></pre></td></tr></table></figure><p>例如，我们要每间隔一小时计算一次过去 24 小时内每个商品的销量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT product, SUM(amount) FROM Orders GROUP BY HOP(rowtime, INTERVAL &#39;1&#39; HOUR, INTERVAL &#39;1&#39; DAY), product</span><br></pre></td></tr></table></figure><p>上述案例中的 INTERVAL ‘1’ HOUR 代表滑动窗口生成的时间间隔。<br><strong><br></strong>会话窗口**<br>会话窗口定义了一个非活动时间，假如在指定的时间间隔内没有出现事件或消息，则会话窗口关闭。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677644-29984377-bb5e-4a2e-82e5-c4256637fc0e.png#align=left&display=inline&height=584&margin=%5Bobject%20Object%5D&originHeight=584&originWidth=1070&size=0&status=done&style=none&width=1070" alt><br>会话窗口的语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    [gk], </span><br><span class="line">    SESSION_START(timeCol, gap) AS winStart,</span><br><span class="line">    SESSION_END(timeCol, gap) AS winEnd,</span><br><span class="line">    agg1(col1),</span><br><span class="line">     ... </span><br><span class="line">    aggn(colN)</span><br><span class="line">FROM Tab1</span><br><span class="line">GROUP BY [gk], SESSION(timeCol, gap)</span><br></pre></td></tr></table></figure><p>举例，我们需要计算每个用户过去 1 小时内的订单量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT user, SESSION_START(rowtime, INTERVAL &#39;1&#39; HOUR) AS sStart, SESSION_ROWTIME(rowtime, INTERVAL &#39;1&#39; HOUR) AS sEnd, SUM(amount) FROM Orders GROUP BY SESSION(rowtime, INTERVAL &#39;1&#39; HOUR), user</span><br></pre></td></tr></table></figure><p><a name="CiNA5"></a></p><h4 id="内置函数-1"><a href="#内置函数-1" class="headerlink" title="内置函数"></a>内置函数</h4><p>Flink 中还有大量的内置函数，我们可以直接使用，将内置函数分类如下：</p><ul><li>比较函数<br></li><li>逻辑函数<br></li><li>算术函数<br></li><li>字符串处理函数<br></li><li>时间函数<br></li></ul><p><strong>比较函数</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677553-ea722757-2429-4f9e-964c-4cd623e0639f.png#align=left&display=inline&height=827&margin=%5Bobject%20Object%5D&originHeight=827&originWidth=1457&size=0&status=done&style=none&width=1457" alt><br><strong>逻辑函数</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677557-526dcd68-ed8b-46bb-bbbc-6e1202a00148.png#align=left&display=inline&height=452&margin=%5Bobject%20Object%5D&originHeight=452&originWidth=1419&size=0&status=done&style=none&width=1419" alt><br><strong>算术函数</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677655-4393133b-b577-49e7-bf1a-df3e99644ad3.png#align=left&display=inline&height=499&margin=%5Bobject%20Object%5D&originHeight=499&originWidth=1419&size=0&status=done&style=none&width=1419" alt><br><strong>字符串处理函数</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677561-8847663c-2ad7-4851-819f-7282af1c3f79.png#align=left&display=inline&height=388&margin=%5Bobject%20Object%5D&originHeight=388&originWidth=1419&size=0&status=done&style=none&width=1419" alt><br><strong>时间函数</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1599355677562-436149c7-1258-45b5-9a12-52099ebac5a9.png#align=left&display=inline&height=488&margin=%5Bobject%20Object%5D&originHeight=488&originWidth=1419&size=0&status=done&style=none&width=1419" alt></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="cpeixin.cn/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/" title="Flink Table API  window操作" target="_blank" rel="external">cpeixin.cn/2019/06/15/Flink-Table-API-window%E6%93%8D%E4%BD%9C/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/cpeixin" target="_blank" class="img-burn thumb-sm visible-lg" rel="external nofollow noopener noreferrer"><img src="/images/avatar.jpg" class="img-rounded w-full" alt></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/cpeixin" target="_blank" rel="external nofollow noopener noreferrer"><span class="text-dark">Brent</span><small class="ml-1x">大数据工程师 &amp; 机器学习</small></a></h3><div>一心九用的工程师</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2019/06/17/Flink%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/" title="Flink核心概念"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2019/06/12/python%E7%88%AC%E8%99%AB%E4%B9%8B%E5%8A%A8%E6%80%81%E7%88%AC%E5%8F%96/" title="python爬虫 - 动态爬取"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/cpeixin" target="_blank" title="Github" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/1970875963" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank" rel="external nofollow noopener noreferrer">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank" rel="external nofollow noopener noreferrer">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var N={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=N}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"SsxmBzBQ3R2S2zWTv0FrONel-gzGzoHsz",appKey:"w0K528Ye7NhOr07RHrzVzHbW",placeholder:"说点什么呢？",avatar:"mm",meta:meta,pageSize:"10",visitor:!0})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a=$(this),t=a.attr("alt"),n=a.parent("a");if(n.length<1){var e=this.getAttribute("src"),r=e.lastIndexOf("?");-1!=r&&(e=e.substring(0,r)),n=a.wrap('<a href="'+e+'"></a>').parent("a")}n.attr("data-fancybox","images"),t&&n.attr("data-caption",t)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script></body></html><script type="text/javascript" src="//cdn.jsdelivr.net/gh/ygbhf/clicklove/clicklove.js"></script><!-- rebuild by neat -->